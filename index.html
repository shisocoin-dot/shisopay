<!DOCTYPE html>
<html lang="en" id="top">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShisoPay | Decentralized Crypto Payment Gateway</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/shisocoin-dot/shisopay/main/shisopayfavicon-32x32.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <header>
    <img src="shisocoin.png" alt="Shiso Logo" class="logo">
    <h1>ðŸ’³ ShisoPay</h1>
    <p>Decentralized Crypto Payment Gateway for Online Merchants</p>
    <a class="btn" href="#about">Learn More</a>
  </header>

  <!-- Navigation -->
  <nav class="menu">
    <div class="menu-toggle" id="mobileMenuToggle">â˜° Menu</div>
    <div class="menu-links" id="menuLinks">
      <a href="#about">About</a>
      <a href="#features">Features</a>
      <a href="#howto">How it Works</a>
      <a href="#shisopay-demo">ShisoPay Demo</a>
      <a href="#contact">Contact</a>
      <a href="#community">Community</a>
    </div>
  </nav>

  <!-- ShisoPay Demo Section -->
  <section id="shisopay-demo">
    <h2>ðŸ’³ ShisoPay Demo</h2>
    <p>Send SHISO tokens to a merchant address directly from your wallet.</p>

    <div style="max-width:500px;margin:auto;text-align:left;">
      <label for="recipient">Merchant Address:</label>
      <div style="display:flex;gap:8px;align-items:center;">
        <input type="text" id="recipient" placeholder="0xMerchantAddress" style="flex:1;padding:8px;">
        <button id="scanQRBtn" class="btn" style="padding:8px 12px;">ðŸ“· Scan</button>
      </div>

      <!-- QR Scanner Area -->
      <div id="qr-scanner-container">
        <div id="qr-scanner-box">
          <div id="qr-reader"></div>
          <button id="closeScannerBtn" class="btn">Close Scanner</button>
        </div>
      </div>

      <label for="usdAmount" style="margin-top:12px;display:block;">Product Price (USD):</label>
      <input type="number" id="usdAmount" placeholder="e.g., 10" value="10" style="width:100%;padding:8px;margin-bottom:10px;">

      <p>Current SHISO Price: $<span id="shisoPrice">0</span></p>
      <p>Amount to Send: <span id="shisoAmount">0</span> SHISO</p>

      <button id="connectWalletBtn" class="btn" style="width:100%;">Connect Wallet</button>
      <button id="sendBtn" class="btn" style="width:100%;margin-top:10px;" disabled>Send SHISO</button>

      <p id="status" style="margin-top:10px;color:#2575fc;"></p>
    </div>
    <a class="back-btn" href="#top">â¬† Back to Menu</a>
  </section>

  <!-- Footer -->
  <footer>
    <p>Â© 2025 ShisoPay | Built for Merchants & the Crypto Community</p>
  </footer>

<!-- Ethers.js + HTML5 QR Code Scanner -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<<script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>

<script>
window.addEventListener("load", () => {
    const connectBtn = document.getElementById("connectWalletBtn");
    const sendBtn = document.getElementById("sendBtn");
    const statusEl = document.getElementById("status");
    const usdInput = document.getElementById("usdAmount");
    const shisoPriceEl = document.getElementById("shisoPrice");
    const shisoAmountEl = document.getElementById("shisoAmount");
    const scanBtn = document.getElementById("scanQRBtn");
    const qrContainer = document.getElementById("qr-scanner-container");
    const closeScannerBtn = document.getElementById("closeScannerBtn");
    const recipientInput = document.getElementById("recipient");

    let provider, signer, userAddress;
    let shisoPrice = 0;
    let html5QrCodeInstance = null;

    const shisoTokenAddress = "0xYourTestnetSHISOToken"; 
    const shisoAbi = ["function transfer(address to, uint amount) public returns (bool)"];

    // Fetch SHISO price in USD
    async function fetchShisoPrice() {
        try {
            const response = await fetch("https://api.geckoterminal.com/api/v2/networks/bsc/pools/0x475b925367f1451b2091a7cae0262f867c9b9f55");
            const data = await response.json();
            shisoPrice = parseFloat(data.data.attributes.base_token_price_usd);
            shisoPriceEl.innerText = shisoPrice.toFixed(6);
            calculateShisoAmount();
        } catch (err) {
            console.error("Error fetching price:", err);
            shisoPriceEl.innerText = "0";
        }
    }

    function calculateShisoAmount() {
        const usd = parseFloat(usdInput.value) || 0;
        const amount = shisoPrice > 0 ? usd / shisoPrice : 0;
        shisoAmountEl.innerText = amount.toFixed(4);
    }

    usdInput.addEventListener("input", calculateShisoAmount);

    // Connect MetaMask Wallet
    connectBtn.addEventListener("click", async () => {
        if (!window.ethereum) { alert("Please install MetaMask!"); return; }
        try {
            await window.ethereum.request({ method: "eth_requestAccounts" });
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            userAddress = await signer.getAddress();

            connectBtn.innerText = `Connected: ${userAddress.substring(0,6)}...${userAddress.slice(-4)}`;
            connectBtn.disabled = true;
            sendBtn.disabled = false;
            statusEl.innerText = "âœ… Wallet connected! Ready to send SHISO.";
        } catch (err) {
            console.error(err);
            statusEl.innerText = "âŒ Wallet connection failed!";
        }
    });

    // Send SHISO Tokens
    sendBtn.addEventListener("click", async () => {
        const recipient = recipientInput.value.trim();
        const amount = parseFloat(shisoAmountEl.innerText);
        if (!recipient || amount <= 0) { alert("Enter a valid recipient and amount."); return; }

        try {
            const contract = new ethers.Contract(shisoTokenAddress, shisoAbi, signer);
            const amountWei = ethers.parseUnits(amount.toString(), 18);

            statusEl.innerText = "â³ Sending transaction...";
            const tx = await contract.transfer(recipient, amountWei);
            statusEl.innerHTML = `ðŸ“¤ Transaction sent! <a href="https://bscscan.com/tx/${tx.hash}" target="_blank">View on BscScan</a>`;
            await tx.wait();
            statusEl.innerHTML = `âœ… Transaction confirmed! <a href="https://bscscan.com/tx/${tx.hash}" target="_blank">View on BscScan</a>`;
        } catch (err) {
            console.error(err);
            statusEl.innerText = "âŒ Transaction failed. Check console.";
        }
    });

    // ----------------------
    // QR SCANNER LOGIC
    // ----------------------
    scanBtn.addEventListener("click", async () => {
        qrContainer.style.display = "flex";

        if (html5QrCodeInstance) {
            try { await html5QrCodeInstance.stop(); html5QrCodeInstance.clear(); } catch(e) {}
            html5QrCodeInstance = null;
        }

        html5QrCodeInstance = new Html5Qrcode("qr-reader");

        try {
            const cameras = await Html5Qrcode.getCameras();
            if (cameras && cameras.length) {
                const cameraId = cameras[0].id; // use first available camera
                html5QrCodeInstance.start(
                    cameraId,
                    { fps: 10, qrbox: { width: 250, height: 250 } },
                    decodedText => {
                        recipientInput.value = decodedText.trim();
                        html5QrCodeInstance.stop().then(() => html5QrCodeInstance.clear());
                        html5QrCodeInstance = null;
                        qrContainer.style.display = "none";
                    },
                    errorMessage => { /* ignore scan errors */ }
                ).catch(err => {
                    console.error("QR start error:", err);
                    qrContainer.style.display = "none";
                });
            } else {
                alert("No camera found on this device.");
                qrContainer.style.display = "none";
            }
        } catch(err) {
            console.error("Camera access error:", err);
            alert("Camera access denied or not available.");
            qrContainer.style.display = "none";
        }
    });

    closeScannerBtn.addEventListener("click", async () => {
        if (html5QrCodeInstance) {
            try {
                await html5QrCodeInstance.stop();
                html5QrCodeInstance.clear();
                html5QrCodeInstance = null;
            } catch(err) { console.error("Error closing scanner:", err); }
        }
        qrContainer.style.display = "none";
    });

    const mobileToggle = document.getElementById('mobileMenuToggle');
    const menuLinks = document.getElementById('menuLinks');

    mobileToggle.addEventListener('click', () => {
        menuLinks.classList.toggle('active');
    });

    // Initial price fetch
    fetchShisoPrice();
    setInterval(fetchShisoPrice, 60000);
});
</script>


</body>
</html>
